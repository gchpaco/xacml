<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>SRFI 11: Syntax for receiving multiple values</title>
  </head>

  <body>

<H1>Title</H1>

SRFI 11: Syntax for receiving multiple values

<H1>Author</H1>

Lars T Hansen

<H1>Status</H1>
This SRFI is currently in ``final'' status.  To see an explanation of each status 
that a SRFI can hold, see <A HREF="http://srfi.schemers.org/srfi-process.html">here</A>.
You can access the discussion via <A HREF=mail-archive/maillist.html>the archive of 
the mailing list</A>.
<P><UL>
<LI>Received: 1999/09/10
<LI>Draft: 1999/09/14-1999/11/12
<LI>Revised: 1999/11/01
<LI>Revised: 2000/03/15
<LI>Final: 2000/03/15
</UL>

<H1>Abstract</H1>

The SRFI introduces syntactic forms LET-VALUES and LET*-VALUES that bind the values of
expressions that return multiple values.

<H1>Issues</H1>

None.

<H1>Rationale</H1>

LET-VALUES and LET*-VALUES reduce the clutter of the CALL-WITH-VALUES notation for
receiving multiple values.


<H1>Specification</H1>

<dl>
<dt><a name="let-values"></a>
<tt>(LET-VALUES ((&lt;formals&gt; &lt;expression&gt;) ...) &lt;body&gt;)</tt>
<br>Syntax
<dd>
<p>Each &lt;formals&gt; should be a formal arguments list as for a LAMBDA 
   expression, cf section 4.1.4 of the R5RS.</p>

<p>The &lt;expression&gt;s are evaluated in the current environment, the 
   variables of the &lt;formals&gt; are bound to fresh locations, the return 
   values of the &lt;expression&gt;s are stored in the variables, the &lt;body&gt; 
   is evaluated in the extended environment, and the values of the
   last expression of &lt;body&gt; are returned.  The &lt;body&gt; is a 
   &lt;tail body&gt;, cf section 3.5 of the R5RS.</p>

<p>The matching of each &lt;formals&gt; to values is as for the matching of 
   &lt;formals&gt; to arguments in a LAMBDA expression, and it is an
   error for an &lt;expression&gt; to return a number of values that does
   not match its corresponding &lt;formals&gt;.</p>

<p>
<pre>
             (let-values (((a b . c) (values 1 2 3 4))))
               (list a b c))            --&gt; (1 2 (3 4))

             (let ((a 'a) (b 'b) (x 'x) (y 'y))
               (let-values (((a b) (values x y))
                            ((x y) (values a b)))
                 (list a b x y)))       --&gt; (x y a b)
</pre>
</p>

<dt><a name="let*-values"></a>
<tt>(LET*-VALUES ((&lt;formals&gt; &lt;expression&gt;) ...) &lt;body&gt;)</tt>
<br>Syntax
<dd>
<p>Each &lt;formals&gt; should be a formal arguments list as for a LAMBDA 
   expression, cf section 4.1.4 of the R5RS.</p>

<p>LET*-VALUES is similar to LET-VALUES, but the bindings are performed
   sequentially from left to right, and the region of a binding indicated
   by (&lt;formals&gt; &lt;expression&gt;) is that part of the LET*-VALUES
   expression to the right of the binding.  Thus the second binding is done in
   an environment in which the first binding is visible, and so on.</p>

<p>
<pre>
             (let ((a 'a) (b 'b) (x 'x) (y 'y))
               (let*-values (((a b) (values x y))
                             ((x y) (values a b)))
                 (list a b x y)))       --&gt; (x y x y)
</pre>
</p>
</dl>

<H1>Implementation</H1>

The following implementation is written in R5RS Scheme.  It is not
compatible with the IEEE Scheme standard because the IEEE standard does
not contain the high-level macro system.

<p>The implementation assumes that some top-level names defined by the
R5RS are bound to their original values.

<p>
<pre>
(define-syntax let-values
  (syntax-rules ()
    ((let-values (?binding ...) ?body0 ?body1 ...)
     (let-values "bind" (?binding ...) () (begin ?body0 ?body1 ...)))
    
    ((let-values "bind" () ?tmps ?body)
     (let ?tmps ?body))
    
    ((let-values "bind" ((?b0 ?e0) ?binding ...) ?tmps ?body)
     (let-values "mktmp" ?b0 ?e0 () (?binding ...) ?tmps ?body))
    
    ((let-values "mktmp" () ?e0 ?args ?bindings ?tmps ?body)
     (call-with-values 
       (lambda () ?e0)
       (lambda ?args
         (let-values "bind" ?bindings ?tmps ?body))))
    
    ((let-values "mktmp" (?a . ?b) ?e0 (?arg ...) ?bindings (?tmp ...) ?body)
     (let-values "mktmp" ?b ?e0 (?arg ... x) ?bindings (?tmp ... (?a x)) ?body))
    
    ((let-values "mktmp" ?a ?e0 (?arg ...) ?bindings (?tmp ...) ?body)
     (call-with-values
       (lambda () ?e0)
       (lambda (?arg ... . x)
         (let-values "bind" ?bindings (?tmp ... (?a x)) ?body))))))

(define-syntax let*-values
  (syntax-rules ()
    ((let*-values () ?body0 ?body1 ...)
     (begin ?body0 ?body1 ...))

    ((let*-values (?binding0 ?binding1 ...) ?body0 ?body1 ...)
     (let-values (?binding0)
       (let*-values (?binding1 ...) ?body0 ?body1 ...)))))
</pre>

<H1>Copyright</H1>
Copyright (C) Lars T Hansen (1999). All Rights Reserved. 
<p>
This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it
or assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are
included on all such copies and derivative works. However, this
document itself may not be modified in any way, such as by removing
the copyright notice or references to the Scheme Request For
Implementation process or editors, except as needed for the purpose of
developing SRFIs in which case the procedures for copyrights defined
in the SRFI process must be followed, or as required to translate it
into languages other than English.
<p>
The limited permissions granted above are perpetual and will not be
revoked by the authors or their successors or assigns.
<p>
This document and the information contained herein is provided on an
"AS IS" basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM ALL
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY
WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A
PARTICULAR PURPOSE.


    <hr>
    <address>Editor: <a href="mailto:srfi-editors@srfi.schemers.org">Mike Sperber</a></address>
<!-- Created: Tue Sep 29 19:20:08 EDT 1998 -->
<!-- hhmts start -->
Last modified: Wed Aug 13 12:17:04 CDT 2003
<!-- hhmts end -->
  </body>
</html>
